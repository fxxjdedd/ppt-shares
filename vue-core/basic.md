---
title: Vueæ ¸å¿ƒä»£ç åˆ†äº«
subtitle: VueæŠ€æœ¯ç³»åˆ—ç¬¬ä¸€ç¯‡
author: å‚…è…¾è¾¾
---

## å…ˆæ”¶é›†ä¸€ä¸‹é—®é¢˜
1. $setä½•æ—¶ç”¨ï¼Œä¸ºä»€ä¹ˆç”¨ï¼ŒåŸç†æ˜¯ä»€ä¹ˆ
2. æ·±å±‚çš„å¯¹è±¡ä¸å“åº”

## é¢ä¸´çš„é—®é¢˜
> æˆ‘ä»¬æ­£é€æ¸ä»å‰ç«¯å·¥ç¨‹å¸ˆå˜æˆ`é…ç½®`å·¥ç¨‹å¸ˆ

- å—åˆ¶äºæ¡†æ¶ç»™æˆ‘ä»¬åˆ¶å®šçš„`ç¼–ç¨‹æ¨¡å‹`ä¸­
- æ¯å¤©çš„å·¥ä½œå°±æ˜¯å†™é…ç½®æ–‡ä»¶ğŸ‘©ğŸ»â€ğŸ’» 
- é€æ¸é€€åŒ–ğŸ’

> ğŸ‘¨ğŸ¼æˆ‘ä»¬æŠŠç²¾åŠ›è¿‡åº¦é›†ä¸­äºè¿™ç§é…ç½®æ–‡ä»¶ï¼Œç¼ºå°‘äº†å¯¹æ¡†æ¶çš„å…¨é¢ç†è§£ï¼Œè¢«æ¡†æ¶ç©å¼„ï¼Œæ­¤æ—¶æ¡†æ¶å°±æ˜¯æˆ‘ä»¬çš„çˆ¸çˆ¸ 

> ğŸ‘¶ğŸ»ä¸ºäº†æ‰­è½¬å±€é¢ï¼Œä¸ºäº†ä¸ºæ‰€æ¬²ä¸ºï¼Œæˆ‘ä»¬éœ€è¦çœ‹æºç ï¼Œè¦è®©æ¡†æ¶æˆä¸ºæˆ‘ä»¬çš„å¼Ÿå¼Ÿ

[^_^]:
  å…³äºå…¨é¢ç†è§£ï¼Œè¦é‡ç‚¹å¼ºè°ƒï¼Œç°åœ¨çš„MVXæ¡†æ¶ï¼Œå±è”½äº†VMè¿™ä¸€å±‚å…·ä½“ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨Modelå’ŒViewã€‚è™½ç„¶è¿™æ ·åšï¼Œå¸¦æ¥äº†å¼€å‘ä¸Šçš„ä¾¿æ·ï¼Œä½†ä¹Ÿç»™è®©æˆ‘ä»¬å¯¹VMå±‚çš„å…·ä½“ç»†èŠ‚ä¸€æ— æ‰€çŸ¥ã€‚

[^_^]:
  ä¸ºæ‰€æ¬²ä¸ºçš„å«ä¹‰æ˜¯ï¼Œæˆ‘ä»¬èƒ½åœ¨ä»»ä½•ç¯å¢ƒä¸‹ä½¿ç”¨Vueï¼Œè€Œä¸æ˜¯éè¦åœ¨.vueæ–‡ä»¶ä¸­,æˆ‘ä»¬æƒ³æ€ä¹ˆç”¨æ€ä¹ˆç”¨

## å¼€å§‹çœ‹ä»£ç 
> æˆ‘ä»¬é¦–å…ˆè¦æ‰¾ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œå‘ç°ä»`package.json`å¼€å§‹å†å¥½ä¸è¿‡äº†
1. `package.json -> scripts -> dev:esm`
2. `scripts/config.js -> line: 55 alias`
3. `src/platforms/web/entry-runtime.js`
4. `src/platforms/web/runtime/index.js`
5. `src/core/index.js`
6. `src/core/instance/index.js`

æ€»ç»“ï¼š Vueå…¶å®å°±æ˜¯ä¸ªå‡½æ•°ï¼Œä»–æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ„é€ å‡½æ•°ï¼Œä»–çš„prototypeä¸Šå¸ƒæ»¡å„ç§æ··å…¥(mixin)çš„æ–¹æ³•

---
> æˆ‘ä»¬å¼€å§‹æ‰¾ä¸‹ä¸€ä¸ªåˆ‡å…¥ç‚¹:

```js
new Vue({
  el: '#app',
  data() {
    return {
      name: 'vue',
      data: {version: 2.5}
    }
  }
})
```
1. `src/core/instance/index.js -> this._init(options) -> Vue.prototype -> initMixin(Vue)`
2. `src/core/instance/init.js -> line: 16 -> line: 55 -> line: 57`
3. `src/core/instance/state.js -> line: 54 -> line: 112 -> line: 147 -> line -> line: 151`
4. `src/core/observer/index -> line: 109`
   
    å¦‚æœå·²ç»è¢«observeè¿‡ï¼Œåˆ™ç›´æ¥è¿”å›`__ob__`ï¼Œå¤§å®¶åº”è¯¥çœ‹åˆ°è¿‡ã€‚å¦åˆ™ï¼Œè¿›è¡ŒObserveåŒ–ã€‚

    `-> line: 37 -> line: 42`

    `__ob__`å…¶å®å°±æ˜¯vmè‡ªå·±ï¼Œä¸æ˜¯Arrayï¼Œæ‰€ä»¥ç›´æ¥`this.walk(value)`

    `-> line: 63`

    éå†valueæ‰€æœ‰keyï¼Œå¯¹æ¯ä¸€ä¸ªkeyè¿›è¡ŒdefineReactive
   
    `-> line: 134 -> line: 141 -> line: 155 -> line: 156`

    è¿™é‡Œä¾¿æ˜¯åŒå‘ç»‘å®šçš„æ ¸å¿ƒï¼Œå‡†ç¡®çš„è¯´æ˜¯æ•°æ®å˜åŒ–è‡ªåŠ¨å“åº”åˆ°è§†å›¾è¿™éƒ¨åˆ†é€»è¾‘çš„æ ¸å¿ƒ
   
    å…ˆçœ‹get, balabala...

    å†çœ‹set, balabala...

    çŸ­çŸ­40å¤šè¡Œä»£ç ï¼Œè¦çœ‹æ‡‚å´éå¸¸å›°éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªå¤§ä½“çš„ç†è§£ï¼Œæœ‰äº†è¿™ä¸ªç†è§£ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç†è§£ä¸‹é¢è¿™ä¸ªå›¾äº†

æ€»ç»“ï¼š å½“æˆ‘ä»¬æ‰§è¡Œnew Vue(options)ï¼Œæˆ‘ä»¬ä¼ å…¥çš„dataçš„`ç°æœ‰çš„key`ä¼šè¢«å“åº”åŒ–(Observable)

> ä¸‹ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªç†Ÿæ‚‰çš„å›¾

![core](images/data.png)



> ä¸‹ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œæˆ‘ä»¬ä»Vueçš„åˆå§‹åŒ–è¿‡ç¨‹å…¥æ‰‹

```js
const options = {å„ç§å±æ€§}
new Vue(options)
```

1. å›åˆ°`src/core/instance/index.js`, å¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°options
2. çœ‹åˆ°æ„é€ å‡½æ•°æœ‰ä¸ª`this._init`ï¼Œå…¶å®æ˜¯æ¥è‡ª`initMixin`ï¼Œç»§ç»­çœ‹
3. `src/core/init -> Vue.prototype._init line: 52 -> line: 59, line: 69`
   1. initLifecycleï¼šä¸»è¦æ˜¯å…³äºè§†å›¾æ›´æ–°çš„ä¸€äº›æ–¹æ³•ï¼Œ`å›å¤´å†çœ‹mountComponent`
   2. initEventsï¼šäº‹ä»¶ç›¸å…³ï¼Œä¸æ˜¯æœ¬æ¬¡åˆ†äº«é‡ç‚¹
   3. initRender: renderç›¸å…³, $createElement, $slots, $scopeSlots, ä¸æ˜¯æœ¬æ¬¡åˆ†äº«é‡ç‚¹
   4. callHook(vm, 'beforeCreate')
   5. initInjectionså’ŒinitProvideï¼šä¸æ˜¯é‡ç‚¹
   6. `initStateï¼šæœ¬æ¬¡åˆ†äº«çš„é‡ç‚¹`
   7. callHook(vm, 'created')
   8. `vm.$mount(vm.$options.el): æœ¬æ¬¡åˆ†äº«çš„é‡ç‚¹`
4. å†å›åˆ°`src/core/instance/index.js`ï¼Œçœ‹å‰©ä¸‹çš„å‡ ä¸ªmixin
   1. stateMixinï¼šä¸»è¦æ˜¯æ··å…¥stateç›¸å…³çš„æ–¹æ³•ï¼Œæ¯”å¦‚`$set, $watch`å›å¤´å†çœ‹
   2. eventMixin: äº‹ä»¶ç›¸å…³ï¼Œä¸æ˜¯é‡ç‚¹
   3. lifecycleMixin: æ··å…¥$forceUpdate, $destroy
   4. renderMixinï¼š`å›å¤´å†çœ‹$nextTick`

æ€»ç»“ï¼šåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç¨å¾®æ·±å…¥äº†ä¸€äº›ï¼Œå¤§æ¦‚äº†è§£äº†Vueè¿™ä¸ªç±»ï¼Œä»å…‰ç§ƒç§ƒçš„ä¸€ä¸ªå‡½æ•°ï¼Œåˆ°ä¸€ä¸ªå…¨å‰¯æ­¦è£…çš„ç±»çš„è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å¼€å§‹çœ‹å…·ä½“çš„ç»†èŠ‚äº†ã€‚

> æˆ‘ä»¬å†çœ‹ä¸€ä¸ªå›¾

![core](images/vue.png)

> ä¸‹ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œæˆ‘ä»¬ä»é—®é¢˜å‡ºå‘

  1. å¦‚ä½•å‡†ç¡®é¢„æµ‹Vueçš„è¡Œä¸º
     1. [å¦‚ä½•ä¼˜é›…ã€å‡†ç¡®çš„ä¿®æ”¹æ•°æ®å¹¶è§¦å‘æ›´æ–°](http://jsrun.net/HDhKp/edit)
     2. Vue3çš„trigger
   
  2. watchæ‰§è¡ŒåŸç†
     1. æ—¢ç„¶æˆ‘ä»¬èƒ½å‡†ç¡®é¢„æµ‹Vueçš„è¡Œä¸ºäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦çœ‹watchçš„åŸç†
     2. [watchæ˜¯æ€æ ·è§¦å‘çš„, æ€æ ·æ‰§è¡Œçš„](http://jsrun.net/kthKp/edit)
     3. [watchçš„immediate](http://jsrun.net/fthKp/edit)
     4. [watchä¸ºä»€ä¹ˆéœ€è¦deepï¼Œè€Œdataä¸éœ€è¦å‘¢](http://jsrun.net/LthKp/edit)
     5. [watchå’Œcomputedçš„åŒºåˆ«ï¼Œä»¥åŠè·Ÿwatcherçš„å…³ç³»](http://jsrun.net/wthKp/edit)
     6. [watcheræœ‰å‡ ä¸ªï¼Œdepæœ‰å‡ ä¸ª, depç»´æŒäº†å‡ ä¸ªwatcher](http://jsrun.net/IthKp/edit)
     7. watcher,dep,Depä¸‰è€…çš„è”ç³»
        1. Dep.targetå…¨å±€å”¯ä¸€ï¼Œæ˜¯ä¸ºäº†ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªwatcheråœ¨watcher.evaluateè¿™ä¸ªè¿‡ç¨‹


  3. [setTimeoutå’Œ$nextTickçš„åŒºåˆ«](http://jsrun.net/DDhKp/edit)
     1. [test1](http://jsrun.net/7thKp/edit)
     2. [test2](http://jsrun.net/cthKp/edit)
     3. [test3](http://jsrun.net/dthKp/edit)